
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The Unity Machine Learning Agents Toolkit (ML-Agents) is an open-source project that enables games and simulations to serve as environments for training intelligent agents.">
      
      
        <meta name="author" content="Unity Technologies">
      
      
        <link rel="canonical" href="https://unity-technologies.github.io/ml-agents/Training-on-Amazon-Web-Service/">
      
      
      
      
      <link rel="icon" href="../images/unity-logo-black.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>Training on Amazon Web Service - Unity ML-Agents Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#training-on-amazon-web-service" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Unity ML-Agents Toolkit" class="md-header__button md-logo" aria-label="Unity ML-Agents Toolkit" data-md-component="logo">
      
  <img src="../images/unity-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Unity ML-Agents Toolkit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Training on Amazon Web Service
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Unity-Technologies/ml-agents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Unity ML-Agents Toolkit" class="md-nav__button md-logo" aria-label="Unity ML-Agents Toolkit" data-md-component="logo">
      
  <img src="../images/unity-logo.png" alt="logo">

    </a>
    Unity ML-Agents Toolkit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Unity-Technologies/ml-agents" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../ML-Agents-Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ML-Agents Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../ML-Agents-Toolkit-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Toolkit Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Background
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Background
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Background-Machine-Learning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Machine Learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Background-PyTorch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyTorch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Background-Unity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../ELO-Rating-System/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ELO
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Interfacing with Unity Builds
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Interfacing with Unity Builds
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-Gym-API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started with the Gym API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-PettingZoo-API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started with the PettingZoo API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-LLAPI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started with the LLAPI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python API Docs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Python API Docs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-Gym-API-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gym API Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-PettingZoo-API-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Petting Zoo Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-LLAPI-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LLAPI Documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Python-On-Off-Policy-Trainer-Documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    On/Off Policy Trainer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Training-Plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing Training via Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorial-Custom-Trainer-Plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Trainer Plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Hugging-Face-Integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HuggingFace
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Limitations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Limitations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Migrating/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrating
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Versioning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Versioning
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-configured-ami" class="md-nav__link">
    Pre-configured AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-your-own-instance" class="md-nav__link">
    Configuring your own instance
  </a>
  
    <nav class="md-nav" aria-label="Configuring your own instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-the-ml-agents-toolkit-on-the-instance" class="md-nav__link">
    Installing the ML-Agents Toolkit on the instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-x-server-optional" class="md-nav__link">
    Setting up X Server (optional)
  </a>
  
    <nav class="md-nav" aria-label="Setting up X Server (optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-and-setup-xorg" class="md-nav__link">
    Install and setup Xorg:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-and-setup-nvidia-driver" class="md-nav__link">
    Update and setup Nvidia driver:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restart-the-ec2-instance" class="md-nav__link">
    Restart the EC2 instance:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-sure-there-are-no-xorg-processes-running" class="md-nav__link">
    Make sure there are no Xorg processes running:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-x-server-and-make-the-ubuntu-use-x-server-for-display" class="md-nav__link">
    Start X Server and make the ubuntu use X Server for display:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ensure-the-xorg-is-correctly-configured" class="md-nav__link">
    Ensure the Xorg is correctly configured:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#training-on-ec2-instance" class="md-nav__link">
    Training on EC2 instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-_data-folder-hasnt-been-copied-cover" class="md-nav__link">
    The _Data folder hasn't been copied cover
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unity-environment-not-responding" class="md-nav__link">
    Unity Environment not responding
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#could-not-launch-x-server" class="md-nav__link">
    Could not launch X Server
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="training-on-amazon-web-service">Training on Amazon Web Service</h1>
<p>:warning: <strong>Note:</strong> We no longer use this guide ourselves and so it may not work
correctly. We've decided to keep it up just in case it is helpful to you.</p>
<p>This page contains instructions for setting up an EC2 instance on Amazon Web
Service for training ML-Agents environments.</p>
<h2 id="pre-configured-ami">Pre-configured AMI</h2>
<p>We've prepared a pre-configured AMI for you with the ID: <code>ami-016ff5559334f8619</code>
in the <code>us-east-1</code> region. It was created as a modification of
<a href="https://aws.amazon.com/marketplace/pp/B077GCH38C">Deep Learning AMI (Ubuntu)</a>.
The AMI has been tested with p2.xlarge instance. Furthermore, if you want to
train without headless mode, you need to enable X Server.</p>
<p>After launching your EC2 instance using the ami and ssh into it, run the
following commands to enable it:</p>
<pre><code class="language-sh"># Start the X Server, press Enter to come to the command line
$ sudo /usr/bin/X :0 &amp;

# Check if Xorg process is running
# You will have a list of processes running on the GPU, Xorg should be in the
# list, as shown below
$ nvidia-smi

# Thu Jun 14 20:27:26 2018
# +-----------------------------------------------------------------------------+
# | NVIDIA-SMI 390.67                 Driver Version: 390.67                    |
# |-------------------------------+----------------------+----------------------+
# | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
# | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
# |===============================+======================+======================|
# |   0  Tesla K80           On   | 00000000:00:1E.0 Off |                    0 |
# | N/A   35C    P8    31W / 149W |      9MiB / 11441MiB |      0%      Default |
# +-------------------------------+----------------------+----------------------+
#
# +-----------------------------------------------------------------------------+
# | Processes:                                                       GPU Memory |
# |  GPU       PID   Type   Process name                             Usage      |
# |=============================================================================|
# |    0      2331      G   /usr/lib/xorg/Xorg                             8MiB |
# +-----------------------------------------------------------------------------+

# Make the ubuntu use X Server for display
$ export DISPLAY=:0
</code></pre>
<h2 id="configuring-your-own-instance">Configuring your own instance</h2>
<p>You could also choose to configure your own instance. To begin with, you will
need an EC2 instance which contains the latest Nvidia drivers, CUDA9, and cuDNN.
In this tutorial we used the
<a href="https://aws.amazon.com/marketplace/pp/B077GCH38C">Deep Learning AMI (Ubuntu)</a>
listed under AWS Marketplace with a p2.xlarge instance.</p>
<h3 id="installing-the-ml-agents-toolkit-on-the-instance">Installing the ML-Agents Toolkit on the instance</h3>
<p>After launching your EC2 instance using the ami and ssh into it:</p>
<ol>
<li>Activate the python3 environment</li>
</ol>
<p><code>sh
   source activate python3</code></p>
<ol>
<li>Clone the ML-Agents repo and install the required Python packages</li>
</ol>
<p><code>sh
   git clone --branch release_20 https://github.com/Unity-Technologies/ml-agents.git
   cd ml-agents/ml-agents/
   pip3 install -e .</code></p>
<h3 id="setting-up-x-server-optional">Setting up X Server (optional)</h3>
<p>X Server setup is only necessary if you want to do training that requires visual
observation input. <em>Instructions here are adapted from this
<a href="https://medium.com/towards-data-science/how-to-run-unity-on-amazon-cloud-or-without-monitor-3c10ce022639">Medium post</a>
on running general Unity applications in the cloud.</em></p>
<p>Current limitations of the Unity Engine require that a screen be available to
render to when using visual observations. In order to make this possible when
training on a remote server, a virtual screen is required. We can do this by
installing Xorg and creating a virtual screen. Once installed and created, we
can display the Unity environment in the virtual environment, and train as we
would on a local machine. Ensure that <code>headless</code> mode is disabled when building
linux executables which use visual observations.</p>
<h4 id="install-and-setup-xorg">Install and setup Xorg:</h4>
<pre><code>```sh
# Install Xorg
$ sudo apt-get update
$ sudo apt-get install -y xserver-xorg mesa-utils
$ sudo nvidia-xconfig -a --use-display-device=None --virtual=1280x1024

# Get the BusID information
$ nvidia-xconfig --query-gpu-info

# Add the BusID information to your /etc/X11/xorg.conf file
$ sudo sed -i 's/    BoardName      "Tesla K80"/    BoardName      "Tesla K80"\n    BusID          "0:30:0"/g' /etc/X11/xorg.conf

# Remove the Section "Files" from the /etc/X11/xorg.conf file
# And remove two lines that contain Section "Files" and EndSection
$ sudo vim /etc/X11/xorg.conf
```
</code></pre>
<h4 id="update-and-setup-nvidia-driver">Update and setup Nvidia driver:</h4>
<pre><code>```sh
# Download and install the latest Nvidia driver for ubuntu
# Please refer to http://download.nvidia.com/XFree86/Linux-#x86_64/latest.txt
$ wget http://download.nvidia.com/XFree86/Linux-x86_64/390.87/NVIDIA-Linux-x86_64-390.87.run
$ sudo /bin/bash ./NVIDIA-Linux-x86_64-390.87.run --accept-license --no-questions --ui=none

# Disable Nouveau as it will clash with the Nvidia driver
$ sudo echo 'blacklist nouveau'  | sudo tee -a /etc/modprobe.d/blacklist.conf
$ sudo echo 'options nouveau modeset=0'  | sudo tee -a /etc/modprobe.d/blacklist.conf
$ sudo echo options nouveau modeset=0 | sudo tee -a /etc/modprobe.d/nouveau-kms.conf
$ sudo update-initramfs -u
```
</code></pre>
<h4 id="restart-the-ec2-instance">Restart the EC2 instance:</h4>
<pre><code>```sh
sudo reboot now
```
</code></pre>
<h4 id="make-sure-there-are-no-xorg-processes-running">Make sure there are no Xorg processes running:</h4>
<pre><code class="language-sh"># Kill any possible running Xorg processes
# Note that you might have to run this command multiple times depending on
# how Xorg is configured.
$ sudo killall Xorg

# Check if there is any Xorg process left
# You will have a list of processes running on the GPU, Xorg should not be in
# the list, as shown below.
$ nvidia-smi

# Thu Jun 14 20:21:11 2018
# +-----------------------------------------------------------------------------+
# | NVIDIA-SMI 390.67                 Driver Version: 390.67                    |
# |-------------------------------+----------------------+----------------------+
# | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
# | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
# |===============================+======================+======================|
# |   0  Tesla K80           On   | 00000000:00:1E.0 Off |                    0 |
# | N/A   37C    P8    31W / 149W |      0MiB / 11441MiB |      0%      Default |
# +-------------------------------+----------------------+----------------------+
#
# +-----------------------------------------------------------------------------+
# | Processes:                                                       GPU Memory |
# |  GPU       PID   Type   Process name                             Usage      |
# |=============================================================================|
# |  No running processes found                                                 |
# +-----------------------------------------------------------------------------+

</code></pre>
<h4 id="start-x-server-and-make-the-ubuntu-use-x-server-for-display">Start X Server and make the ubuntu use X Server for display:</h4>
<pre><code>```console
# Start the X Server, press Enter to come back to the command line
$ sudo /usr/bin/X :0 &amp;

# Check if Xorg process is running
# You will have a list of processes running on the GPU, Xorg should be in the list.
$ nvidia-smi

# Make the ubuntu use X Server for display
$ export DISPLAY=:0
```
</code></pre>
<h4 id="ensure-the-xorg-is-correctly-configured">Ensure the Xorg is correctly configured:</h4>
<pre><code>```sh
# For more information on glxgears, see ftp://www.x.org/pub/X11R6.8.1/doc/glxgears.1.html.
$ glxgears
# If Xorg is configured correctly, you should see the following message

# Running synchronized to the vertical refresh.  The framerate should be
# approximately the same as the monitor refresh rate.
# 137296 frames in 5.0 seconds = 27459.053 FPS
# 141674 frames in 5.0 seconds = 28334.779 FPS
# 141490 frames in 5.0 seconds = 28297.875 FPS

```
</code></pre>
<h2 id="training-on-ec2-instance">Training on EC2 instance</h2>
<ol>
<li>In the Unity Editor, load a project containing an ML-Agents environment (you
   can use one of the example environments if you have not created your own).</li>
<li>Open the Build Settings window (menu: File &gt; Build Settings).</li>
<li>Select Linux as the Target Platform, and x86_64 as the target architecture
   (the default x86 currently does not work).</li>
<li>Check Headless Mode if you have not setup the X Server. (If you do not use
   Headless Mode, you have to setup the X Server to enable training.)</li>
<li>Click Build to build the Unity environment executable.</li>
<li>Upload the executable to your EC2 instance within <code>ml-agents</code> folder.</li>
<li>Change the permissions of the executable.</li>
</ol>
<p><code>sh
   chmod +x &lt;your_env&gt;.x86_64</code></p>
<ol>
<li>(Without Headless Mode) Start X Server and use it for display:</li>
</ol>
<p>```sh
   # Start the X Server, press Enter to come back to the command line
   $ sudo /usr/bin/X :0 &amp;</p>
<p># Check if Xorg process is running
   # You will have a list of processes running on the GPU, Xorg should be in the list.
   $ nvidia-smi</p>
<p># Make the ubuntu use X Server for display
   $ export DISPLAY=:0
   ```</p>
<ol>
<li>Test the instance setup from Python using:</li>
</ol>
<p>```python
   from mlagents_envs.environment import UnityEnvironment</p>
<p>env = UnityEnvironment(<your_env>)
   ```</p>
<p>Where <code>&lt;your_env&gt;</code> corresponds to the path to your environment executable.</p>
<p>You should receive a message confirming that the environment was loaded
   successfully.</p>
<ol>
<li>
<p>Train your models</p>
<p><code>console
mlagents-learn &lt;trainer-config-file&gt; --env=&lt;your_env&gt; --train</code></p>
</li>
</ol>
<h2 id="faq">FAQ</h2>
<h3 id="the-_data-folder-hasnt-been-copied-cover">The <Executable_Name>_Data folder hasn't been copied cover</h3>
<p>If you've built your Linux executable, but forget to copy over the corresponding
<Executable_Name>_Data folder, you will see error message like the following:</p>
<pre><code class="language-sh">Set current directory to /home/ubuntu/ml-agents/ml-agents
Found path: /home/ubuntu/ml-agents/ml-agents/3dball_linux.x86_64
no boot config - using default values

(Filename:  Line: 403)

There is no data folder
</code></pre>
<h3 id="unity-environment-not-responding">Unity Environment not responding</h3>
<p>If you didn't setup X Server or hasn't launched it properly, or your environment
somehow crashes, or you haven't <code>chmod +x</code> your Unity Environment, all of these
will cause connection between Unity and Python to fail. Then you will see
something like this:</p>
<pre><code class="language-console">Logging to /home/ubuntu/.config/unity3d/&lt;Some_Path&gt;/Player.log
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/home/ubuntu/ml-agents/ml-agents/mlagents_envs/environment.py&quot;, line 63, in __init__
    aca_params = self.send_academy_parameters(rl_init_parameters_in)
  File &quot;/home/ubuntu/ml-agents/ml-agents/mlagents_envs/environment.py&quot;, line 489, in send_academy_parameters
    return self.communicator.initialize(inputs).rl_initialization_output
  File &quot;/home/ubuntu/ml-agents/ml-agents/mlagents_envs/rpc_communicator.py&quot;, line 60, in initialize
mlagents_envs.exception.UnityTimeOutException: The Unity environment took too long to respond. Make sure that :
         The environment does not need user interaction to launch
         The environment and the Python interface have compatible versions.
</code></pre>
<p>It would be also really helpful to check your
/home/ubuntu/.config/unity3d/<Some_Path>/Player.log to see what happens with
your Unity environment.</p>
<h3 id="could-not-launch-x-server">Could not launch X Server</h3>
<p>When you execute:</p>
<pre><code class="language-sh">sudo /usr/bin/X :0 &amp;
</code></pre>
<p>You might see something like:</p>
<pre><code class="language-sh">X.Org X Server 1.18.4
...
(==) Log file: &quot;/var/log/Xorg.0.log&quot;, Time: Thu Oct 11 21:10:38 2018
(==) Using config file: &quot;/etc/X11/xorg.conf&quot;
(==) Using system config directory &quot;/usr/share/X11/xorg.conf.d&quot;
(EE)
Fatal server error:
(EE) no screens found(EE)
(EE)
Please consult the X.Org Foundation support
         at http://wiki.x.org
 for help.
(EE) Please also check the log file at &quot;/var/log/Xorg.0.log&quot; for additional information.
(EE)
(EE) Server terminated with error (1). Closing log file.
</code></pre>
<p>And when you execute:</p>
<pre><code class="language-sh">nvidia-smi
</code></pre>
<p>You might see something like:</p>
<pre><code class="language-sh">NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.
</code></pre>
<p>This means the NVIDIA's driver needs to be updated. Refer to
<a href="./#update-and-setup-nvidia-driver">this section</a>
for more information.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      com.unity.ml-agents copyright © 2017 - 2022 Unity Technologies
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.94c44541.min.js"></script>
      
    
  </body>
</html>